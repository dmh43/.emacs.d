from nose2.compat import unittest
import sys
sys.path.append("../")
import cursors
import circuit

def components_to_refdesigs(component_list):
    return [x.refdes for x in component_list]

class CircuitTest(unittest.TestCase):
    def setUp(self):
        self.my_circuit = circuit.Circuit("../resources/my_circuit.crt")

    def test_create_nodes(self):
        self.my_circuit.create_nodes()
        self.assertEqual(3,
                         len(self.my_circuit.nodedict))
        for node in self.my_circuit.nodedict.values():
            self.assertIsInstance(circuit.Node,
                                  node)
        
class CursorTest(unittest.TestCase):
    def setUp(self):
        self.my_node = circuit.Node(0)
        self.my_empty_cursor = cursors.Cursor(self.my_node)
        self.my_circuit = circuit.Circuit("../resources/my_circuit.crt")
        self.my_circuit.create_nodes()
        self.my_cursor = cursors.Cursor(self.my_circuit.nodedict[0])

    def test_step_to(self):
        self.my_circuit.populate_nodes()
        self.assertEqual(["R1", "R2", "V1"],
                         components_to_refdesigs(self.my_cursor.step_to(self.my_circuit.nodedict[1])))
        self.assertEqual(self.my_circuit.nodedict[1],
                         self.my_cursor.last_node_seen())
        
    def test_unseen(self):
        self.assertEqual(self.my_circuit.component_list,
                         self.my_cursor.unseen(self.my_circuit.component_list))
        self.my_cursor.step_to(self.my_circuit.nodedict[1])
        self.assertEqual(components_to_refdesigs(self.my_cursor.unseen_connected()),
                         ["V2"])
        self.my_cursor.step_to(self.my_circuit.nodedict[0])
        self.assertEqual(components_to_refdesigs(self.my_cursor.unseen_connected()),
                         ["V2"])
        
    def test_unseen_connected(self):
        self.assertEqual(["R1", "R2", "V1"],
                         [x.refdes for x in self.my_cursor.unseen_connected()])
        self.my_cursor.step_to(self.my_circuit.nodedict[1])
        self.assertEqual(["V2"],
                         [x.refdes for x in self.my_cursor.unseen_connected()])
        self.my_cursor.step_to(self.my_circuit.nodedict[0])
        self.assertEqual([],
                         self.my_cursor.unseen_connected())
        
        
if __name__ == '__main__':
    unittest.main()
